<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admina - Barastion Watchtower</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1 class="gradient-text">Panel Admina</h1>
            <nav>
                <a href="index.html">Powrót</a>
                <button id="logout-btn">Wyloguj się</button>
            </nav>
        </header>
        <main>
            <section class="admin-form">
                <h2>Dodaj nowy wpis</h2>
                <form id="post-form">
                    <input type="text" id="chapter" placeholder="Rozdział (np. 10)" required>
                    <input type="date" id="dream-date" required>
                    <textarea id="content" placeholder="Treść snu" required></textarea>
                    <button type="submit">Dodaj wpis</button>
                </form>
            </section>
        </main>
        <footer>
            <p>© 2024 Barastion Watchtower. Wszystkie prawa zastrzeżone.</p>
        </footer>
    </div>
    <script>
        const firebaseConfig = {
            // Wstaw swoje dane z Firebase
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        auth.onAuthStateChanged(async (user) => {
            if (!user || !user.emailVerified) {
                window.location.href = 'index.html';
                return;
            }
            const userDoc = await db.collection('users').doc(user.uid).get();
            if (!userDoc.exists || userDoc.data().role !== 'admin') {
                window.location.href = 'index.html';
            }
        });

        document.getElementById('logout-btn').addEventListener('click', () => auth.signOut());

        document.getElementById('post-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const chapter = document.getElementById('chapter').value;
            const dreamDate = document.getElementById('dream-date').value;
            const content = document.getElementById('content').value;
            const postDate = new Date().toISOString().split('T')[0];

            try {
                await db.collection('posts').add({
                    chapter,
                    dreamDate,
                    content,
                    postDate,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert('Wpis dodano pomyślnie!');
                document.getElementById('post-form').reset();
            } catch (error) {
                alert('Błąd: ' + error.message);
            }
        });
    </script>
</body>
</html>